
<html>
<head>
<title>Quantum Christmas Puzzle</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
<script>

function decrypt(ciphertext, answer) {
    var bare_answer = answer.toLowerCase().replace(/\s/g, '');
    var result = CryptoJS.AES.decrypt(ciphertext, bare_answer).toString(CryptoJS.enc.Utf8);
    return result == "correct";
}

function checkAnswer(answer, puzzleNumber) {
    const url = "https://guenp.github.io/puzzles/ciphers.txt"
    fetch(url)
    .then( response => response.text() )
    .then( text => text.split("\n") )
    .then( textList => {
        return textList[puzzleNumber - 1] 
    })
    .then( cipher => decrypt(cipher, answer) )
    .then( correct => {
        if (correct) {
            return "Your answer is correct!";
        } else {
            return "Your answer is not correct";
        }
    })
    .then(txt => {
        var p = document.getElementById('response');
        if (p.childNodes.length > 0) {
            p.removeChild(p.childNodes[0]);
        }
        p.appendChild(document.createTextNode(txt))
    })
}

function submitAnswer(btn) {
    var answer = document.getElementById('answer1');
    checkAnswer(answer.value, 1);
}

function readSearchParams() {
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    var answer = urlParams.get('answer1');
    var answerInput = document.getElementById('answer1');
    answerInput.value = answer;
    var btn = document.getElementById('button1');
    if (answer != null) {
        submitAnswer(btn);
    }
}

</script>
</head>

<body onload="readSearchParams()">

<div>
    <img src="puzzle1.png" width=400>
</div>

<form id="puzzle1">
    <input type="text" name="answer1" id="answer1">
</form>

<p id="response"></p>
<button onclick="submitAnswer(this)" id="button1">submit</button>
<button onclick="showRoof()" id="button1">go back</button>

</body>
</html>
